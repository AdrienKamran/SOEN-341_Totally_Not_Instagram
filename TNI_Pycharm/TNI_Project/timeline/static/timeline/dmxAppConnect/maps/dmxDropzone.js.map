{"version":3,"sources":["components/dropzone.js"],"names":["dmx","Component","extends","initialData","file","files","lastError","attributes","accept","type","String","default","message","thumbs","thumb-width","Number","thumb-height","methods","remove","id","this","reset","render","node","form","$node","idx","dmxExtraData","document","createElement","className","innerHTML","props","dropzone","style","cssText","classList","add","appendChild","addEventListener","click","bind","dragover","dragenter","dragleave","drop","change","dom","replace","requestAnimationFrame","addSubmitHandler","console","warn","dmxComponent","submit","update","data","length","name","event","addFiles","target","ea","preventDefault","stopPropagation","dataTransfer","effectAllowed","e","dropEffect","items","webkitGetAsEntry","addFilesFromItems","getValidationRules","rules","i","attribute","test","rule","substr","toLowerCase","getAttribute","param","value","push","validate","split","some","charAt","match","RegExp","size","j","setErrorMessage","err","getElementById","bootstrap4forms","bootstrap3forms","insertAdjacentElement","textContent","element","multiple","hasAttribute","validity","Array","isArray","forEach","thumb","parentNode","removeChild","set","index","findIndex","info","splice","requestUpdate","createThumb","title","setProperty","parseInt","filename","filesize","formatSize","number","decimals","binary","isNaN","isFinite","base","suffix","n","Math","pow","round","resize","src","cb","img","tWidth","tHeight","onload","canvas","ctx","getContext","sWidth","width","sHeight","height","min","tRatio","sx","sy","drawImage","toDataURL","addFile","errorMessage","date","lastModified","Date","lastModifiedDate","toISOString","dataUrl","indexOf","reader","FileReader","result","readAsDataURL","concat","array","item","entry","isFile","getAsFile","isDirectory","addFilesFromDirectory","kind","directory","path","createReader","readEntries","entries","fullPath","error"],"mappings":"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","file":"../dmxDropzone/dmxDropzone.js","sourcesContent":["dmx.Component('dropzone', {\r\n\r\n    extends: 'input',\r\n\r\n    initialData: {\r\n        file: null,\r\n        files: [],\r\n        lastError: ''\r\n    },\r\n\r\n    attributes: {\r\n        accept: {\r\n            type: String,\r\n            default: ''\r\n        },\r\n\r\n        message: {\r\n            type: String,\r\n            default: 'Drop files here or click to upload.'\r\n        },\r\n\r\n        'thumbs': {\r\n            type: String,\r\n            default: 'true'\r\n        },\r\n\r\n        'thumb-width': {\r\n            type: Number,\r\n            default: 100\r\n        },\r\n\r\n        'thumb-height': {\r\n            type: Number,\r\n            default: 100\r\n        }\r\n    },\r\n\r\n    methods: {\r\n        remove: function(id) {\r\n            this.remove(id);\r\n        },\r\n\r\n        reset: function() {\r\n            this.reset();\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.form = this.$node.form;\r\n        this.idx = 0;\r\n\r\n        if (!this.form || !this.form.dmxExtraData) {\r\n            console.warn('Filedrop can only work on a serverconnect form!');\r\n            return;\r\n        }\r\n\r\n        this.message = document.createElement('div');\r\n        this.message.className = 'dmxDropzoneMessage';\r\n        this.message.innerHTML = this.props.message;\r\n\r\n        this.dropzone = document.createElement('div');\r\n        this.dropzone.style.cssText = this.$node.style.cssText;\r\n        this.dropzone.className = this.$node.className;\r\n        this.dropzone.classList.add('dmxDropzone');\r\n        this.dropzone.appendChild(this.message);\r\n\r\n        this.dropzone.addEventListener('click', this.click.bind(this));\r\n\r\n        this.dropzone.addEventListener('dragover', this.dragover.bind(this));\r\n        this.dropzone.addEventListener('dragenter', this.dragenter.bind(this));\r\n        this.dropzone.addEventListener('dragleave', this.dragleave.bind(this));\r\n        this.dropzone.addEventListener('drop', this.drop.bind(this));\r\n\r\n        this.$node.addEventListener('change', this.change.bind(this));\r\n        //this.form.addEventListener('submit', this.submit.bind(this));\r\n        this.form.addEventListener('reset', this.reset.bind(this));\r\n\r\n        dmx.dom.replace(this.$node, this.dropzone);\r\n\r\n        requestAnimationFrame(this.addSubmitHandler.bind(this));\r\n    },\r\n\r\n    addSubmitHandler: function() {\r\n        this.form.dmxComponent.addEventListener('submit', this.submit.bind(this));\r\n    },\r\n\r\n    update: function(props) {\r\n        var message = this.props.message;\r\n\r\n        if (this.data.files.length) {\r\n            message += ' (' + this.data.files.length + ' files)';\r\n        } else if (this.data.file) {\r\n            message += ' (' + this.data.file.name + ')';\r\n        }\r\n\r\n        if (this.message && this.message.innerHTML != message) {\r\n            this.message.innerHTML = message;\r\n        }\r\n    },\r\n\r\n    click: function(event) {\r\n        this.$node.click();\r\n    },\r\n\r\n    change: function(event) {\r\n        this.addFiles(event.target.files);\r\n    },\r\n\r\n    dragover: function(event) {\r\n        // prevent default to allow drop\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        var ea;\r\n        try { ea = event.dataTransfer.effectAllowed; } catch(e) {}\r\n\r\n        event.dataTransfer.dropEffect = (ea == 'move' || ea == 'linkMove') ? 'move' : 'copy';\r\n    },\r\n\r\n    dragenter: function(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        this.dropzone.classList.add('dmxDropzoneHover');\r\n    },\r\n\r\n    dragleave: function(event) {\r\n        this.dropzone.classList.remove('dmxDropzoneHover');\r\n    },\r\n\r\n    drop: function(event) {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        this.dropzone.classList.remove('dmxDropzoneHover');\r\n\r\n        if (!event.dataTransfer) return;\r\n\r\n        var files = event.dataTransfer.files;\r\n\r\n        if (files.length) {\r\n            var items = event.dataTransfer.items;\r\n\r\n            if (items && items.length && items[0].webkitGetAsEntry) {\r\n                this.addFilesFromItems(items);\r\n            } else {\r\n                this.addFiles(files);\r\n            }\r\n        }\r\n    },\r\n\r\n    getValidationRules: function() {\r\n        var rules = [];\r\n\r\n        for (var i = 0; i < this.$node.attributes.length; i++) {\r\n            var attribute = this.$node.attributes[i];\r\n\r\n            if (/^data-rule-/.test(attribute.name)) {\r\n                var rule = attribute.name.substr(10).toLowerCase();\r\n                var message = this.$node.getAttribute('data-msg-' + rule);\r\n                var param = attribute.value;\r\n                rules.push({ rule: rule, param: param, message: message });\r\n            }\r\n        }\r\n\r\n        return rules;\r\n    },\r\n\r\n    validate: function(file) {\r\n        if (this.props.accept) {\r\n            if (!this.props.accept.split(/\\s*,\\s*/g).some(function(type) {\r\n                if (type.charAt(0) == '.') {\r\n                    if (file.name.match(new RegExp('\\\\' + type + '$', 'i'))) {\r\n                        return true;\r\n                    }\r\n                } else if (/(audio|video|image)\\/\\*/i.test(type)) {\r\n                    if (file.type.match(new RegExp('^' + type.replace(/\\*/g, '.*') + '$', 'i'))) {\r\n                        return true;\r\n                    }\r\n                } else {\r\n                    if (file.type.toLowerCase() == type.toLowerCase()) {\r\n                        return true;\r\n                    }\r\n                }\r\n\r\n                return false;\r\n            })) {\r\n                return this.$node.getAttribute('data-msg-accept') || 'This file type is not allowed for upload.';\r\n            }\r\n        }\r\n\r\n        var rules = this.getValidationRules();\r\n\r\n        for (var i = 0; i < rules.length; i++) {\r\n            var rule = rules[i].rule;\r\n            var param = rules[i].param;\r\n            var message = rules[i].message;\r\n\r\n            switch (rule) {\r\n                case 'minsize':\r\n                    if (file.size < param) {\r\n                        return (message || 'Please select a file of at least {0} bytes.').replace('{0}', param);\r\n                    }\r\n                break;\r\n\r\n                case 'maxsize':\r\n                    if (file.size > param) {\r\n                        return (message || 'Please select a file of no more than {0} bytes.').replace('{0}', param);\r\n                    }\r\n                break;\r\n\r\n                case 'maxtotalsize':\r\n                    var size = 0;\r\n                    for (var j = 0; j < this.data.files.length; j++) {\r\n                        size += this.data.files[j].size;\r\n                    }\r\n                    if (size + file.size > param) {\r\n                        return (message || 'Total size of selected files should be no more than {0} bytes.').replace('{0}', param);\r\n                    }\r\n                break;\r\n\r\n                case 'maxfiles':\r\n                    if (this.data.files.length >= param) {\r\n                        return (message || 'Please select no more than {0} files.').replace('{0}', param);\r\n                    }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    },\r\n\r\n    setErrorMessage: function(message) {\r\n        var id = 'dmxValidationError' + this.form.getAttribute('id') + (this.$node.getAttribute('name') || this.$node.getAttribute('id'));\r\n        var err = document.getElementById(id);\r\n\r\n        if (!err) {\r\n            err = document.createElement(dmx.bootstrap4forms ? 'div' : 'span');\r\n            err.id = id;\r\n            err.className = dmx.bootstrap4forms ? 'invalid-feedback' : dmx.bootstrap3forms ? 'help-block' : 'dmxValidator-error';\r\n            this.dropzone.insertAdjacentElement('afterend', err);\r\n        }\r\n\r\n        if (dmx.bootstrap4forms) {\r\n            this.dropzone.classList.add('form-control');\r\n            if (message) {\r\n                this.dropzone.classList.remove('is-valid');\r\n                this.dropzone.classList.add('is-invalid');\r\n            } else {\r\n                this.dropzone.classList.remove('is-invalid');\r\n                this.dropzone.classList.add('is-valid');\r\n            }\r\n        }\r\n\r\n        err.textContent = message;\r\n    },\r\n\r\n    submit: function(event) {\r\n        if (dmx.rules) {\r\n            this.setErrorMessage('');\r\n\r\n            var element = {\r\n                type: 'file',\r\n                files: this.$node.multiple ? this.data.files : (this.data.file ? [this.data.file] : [])\r\n            };\r\n\r\n            if (this.$node.hasAttribute('required') && !element.files.length) {\r\n                var message = this.$node.getAttribute('data-msg-required') || 'This field is required.';\r\n                this.setErrorMessage(message);\r\n                event.preventDefault();\r\n                return false;\r\n            }\r\n\r\n            var rules = this.getValidationRules();\r\n\r\n            for (var i = 0; i < rules.length; i++) {\r\n                var rule = rules[i].rule;\r\n                var param = rules[i].param;\r\n\r\n                if (dmx.rules[rule]) {\r\n                    if (!dmx.rules[rule].validity(element, param)) {\r\n                        var message = rules[i].message || dmx.rules[rule].message;\r\n                        if (Array.isArray(param)) {\r\n                            message = message.replace(/\\{(\\d)\\}/g, function(match, i) {\r\n                                return param[i];\r\n                            });\r\n                        } else {\r\n                            message = message.replace(/\\{0\\}/g, param);\r\n                        }\r\n\r\n                        this.setErrorMessage(message);\r\n\r\n                        event.preventDefault();\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    reset: function() {\r\n        if (this.form.dmxExtraData[this.$node.name]) {\r\n            if (Array.isArray(this.form.dmxExtraData[this.$node.name])) {\r\n                this.form.dmxExtraData[this.$node.name].forEach(function(file) {\r\n                    if (file.thumb) file.thumb.remove();\r\n                });\r\n            } else if (this.form.dmxExtraData[this.$node.name].thumb) {\r\n                this.form.dmxExtraData[this.$node.name].thumb.remove();\r\n            }\r\n        }\r\n\r\n        var id = 'dmxValidationError' + this.form.getAttribute('id') + (this.$node.getAttribute('name') || this.$node.getAttribute('id'));\r\n        var err = document.getElementById(id);\r\n\r\n        if (err && err.parentNode) {\r\n            err.parentNode.removeChild(err);\r\n        }\r\n\r\n        if (dmx.bootstrap4forms) {\r\n            this.dropzone.classList.remove('is-valid');\r\n            this.dropzone.classList.remove('is-invalid');\r\n        }\r\n\r\n        this.form.dmxExtraData[this.$node.name] = null;\r\n        this.set('files', []);\r\n        this.set('file', null);\r\n    },\r\n\r\n    remove: function(id, event) {\r\n        if (event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n        }\r\n\r\n        if (this.$node.multiple) {\r\n            var index = this.data.files.findIndex(function(info) {\r\n                return info.id == id;\r\n            });\r\n\r\n            if (index != -1) {\r\n                this.data.files.splice(index, 1);\r\n                this.form.dmxExtraData[this.$node.name][index].thumb.remove();\r\n                this.form.dmxExtraData[this.$node.name].splice(index, 1);\r\n                dmx.requestUpdate();\r\n            }\r\n        } else if (this.data.file) {\r\n            this.data.file = null;\r\n            this.form.dmxExtraData[this.$node.name].thumb.remove();\r\n            this.form.dmxExtraData[this.$node.name] = null;\r\n            dmx.requestUpdate();\r\n        }\r\n    },\r\n\r\n    createThumb: function(file) {\r\n        var thumb = document.createElement('div');\r\n        thumb.className = 'dmxDropzoneThumb';\r\n        thumb.title = file.name;\r\n        thumb.style.setProperty('width', (parseInt(this.props['thumb-width']) || 100) + 'px');\r\n        thumb.style.setProperty('height', (parseInt(this.props['thumb-height']) || 100) + 'px');\r\n        thumb.addEventListener('click', this.remove.bind(this, file.id));\r\n\r\n        var filename = document.createElement('div');\r\n        filename.className = 'dmxDropzoneFilename';\r\n        filename.textContent = file.name;\r\n        thumb.appendChild(filename);\r\n\r\n        var filesize = document.createElement('div');\r\n        filesize.className = 'dmxDropzoneFilesize';\r\n        filesize.textContent = this.formatSize(file.size);\r\n        thumb.appendChild(filesize);\r\n\r\n        file.thumb = thumb;\r\n\r\n        this.dropzone.appendChild(thumb);\r\n    },\r\n\r\n    formatSize: function(number, decimals, binary) {\r\n        if (isNaN(number) || !isFinite(number)) return 'Invalid Size';\r\n\r\n        decimals = decimals || 1;\r\n\r\n        var base = binary ? 1024 : 1000;\r\n        var suffix = binary ? ['KiB', 'MiB', 'GiB', 'TiB'] : ['KB', 'MB', 'GB', 'TB'];\r\n\r\n        for (var i = 3; i >= 0; i--) {\r\n            var n = Math.pow(base, i + 1);\r\n            if (number >= n) {\r\n                number /= n;\r\n                var pow = Math.pow(10, decimals);\r\n                number = Math.round(number * pow) / pow;\r\n                return number + suffix[i];\r\n            }\r\n        }\r\n\r\n        return number + 'B';\r\n    },\r\n\r\n    resize: function(src, cb) {\r\n        var img = document.createElement('img');\r\n\r\n        var tWidth = parseInt(this.props['thumb-width']) || 100;\r\n        var tHeight = parseInt(this.props['thumb-height']) || 100;\r\n\r\n        img.onload = function() {\r\n            var canvas = document.createElement('canvas');\r\n            var ctx = canvas.getContext('2d');\r\n\r\n            var sWidth = img.width;\r\n            var sHeight = img.height;\r\n\r\n            tWidth = Math.min(tWidth, sWidth);\r\n            tHeight = Math.min(tHeight, sHeight);\r\n\r\n            var sRatio = sWidth / sHeight;\r\n            var tRatio = tWidth / tHeight;\r\n\r\n            if (sWidth > tWidth || sHeight > tHeight) {\r\n                if (sRatio > tRatio) {\r\n                    sWidth = sHeight * tRatio;\r\n                } else {\r\n                    sHeight = sWidth / tRatio;\r\n                }\r\n            }\r\n\r\n            canvas.width = tWidth;\r\n            canvas.height = tHeight;\r\n\r\n            var sx = (img.width - sWidth) / 2;\r\n            var sy = (img.height - sHeight) / 2;\r\n\r\n            ctx.drawImage(img, sx, sy, sWidth, sHeight, 0, 0, tWidth, tHeight);\r\n\r\n            cb(canvas.toDataURL());\r\n        };\r\n        img.src = src;\r\n    },\r\n\r\n    addFile: function(file) {\r\n        var errorMessage = this.validate(file);\r\n\r\n        if (errorMessage) {\r\n            this.setErrorMessage(errorMessage);\r\n            return;\r\n        }\r\n\r\n        this.setErrorMessage('');\r\n\r\n        if (this.$node.multiple) {\r\n            this.form.dmxExtraData[this.$node.name] = this.form.dmxExtraData[this.$node.name] || [];\r\n            this.form.dmxExtraData[this.$node.name].push(file);\r\n        } else {\r\n            this.remove();\r\n            this.form.dmxExtraData[this.$node.name] = file;\r\n        }\r\n\r\n        file.id = ++this.idx\r\n\r\n        var info = {\r\n            id: file.id,\r\n            date: (file.lastModified ? new Date(file.lastModified) : file.lastModifiedDate).toISOString(),\r\n            name: file.name,\r\n            size: file.size,\r\n            type: file.type,\r\n            dataUrl: null\r\n        };\r\n\r\n        if (this.props.thumbs != 'false') {\r\n            this.createThumb(file);\r\n        }\r\n\r\n        if (file.type.indexOf('image/') !== -1 && !file.reader) {\r\n            file.reader = new FileReader();\r\n\r\n            file.reader.onload = function(event) {\r\n                info.dataUrl = event.target.result;\r\n                if (file.thumb) {\r\n                    this.resize(info.dataUrl, function(dataUrl) {\r\n                        file.thumb.style.setProperty('background-image', 'url(' + dataUrl + ')');\r\n                    });\r\n                }\r\n                dmx.requestUpdate();\r\n            }.bind(this);\r\n\r\n            file.reader.readAsDataURL(file);\r\n        }\r\n\r\n        if (this.$node.multiple) {\r\n            this.set('files', this.data.files.concat([info]));\r\n        } else {\r\n            this.set('file', info);\r\n        }\r\n    },\r\n\r\n    addFiles: function(files) {\r\n        dmx.array(files).forEach(function(file) {\r\n            this.addFile(file);\r\n        }, this);\r\n    },\r\n\r\n    addFilesFromItems: function(items) {\r\n        dmx.array(items).forEach(function(item) {\r\n            var entry;\r\n            if (item.webkitGetAsEntry && (entry = item.webkitGetAsEntry())) {\r\n                if (entry.isFile) {\r\n                    this.addFile(item.getAsFile());\r\n                } else if (entry.isDirectory) {\r\n                    this.addFilesFromDirectory(entry);\r\n                }\r\n            } else if (item.getAsFile) {\r\n                if (!item.kind || item.kind == 'file') {\r\n                    this.addFile(item.getAsFile());\r\n                }\r\n            }\r\n        }, this);\r\n    },\r\n\r\n    addFilesFromDirectory: function(directory, path) {\r\n        var reader = directory.createReader();\r\n        var readEntries = function() {\r\n            reader.readEntries(function(entries) {\r\n                if (entries.length) {\r\n                    entries.forEach(function(entry) {\r\n                        if (entry.isFile) {\r\n                            entry.file(function(file) {\r\n                                file.fullPath = path + '/' + file.name;\r\n                                this.addFile(file);\r\n                            }.bind(this));\r\n                        } else if (entry.isDirectory) {\r\n                            this.addFilesFromDirectory(entry, path + '/' + entry.name);\r\n                        }\r\n                    }, this);\r\n                }\r\n\r\n                readEntries();\r\n            }.bind(this), function(error) {\r\n                console.warn(error);\r\n            }.bind(this));\r\n        }.bind(this);\r\n\r\n        readEntries();\r\n    }\r\n\r\n});\r\n"]}